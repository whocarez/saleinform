<?php/** * Menu_model *  * @author Mazvv * @package Extenders */class Menu_model extends Model {
	public function __construct(){		parent::Model();	}	
	public function get_menu_items($uprid, $all = True){		$this->db->select('_positions_menus.rid, 							_positions_menus.item_rights, 							_positions_menus.item_area, 							_positions_menus.parent, 							_positions_menus.constant_search_rule,							_positions_menus.default_sort_rule,							_menu_items.item_name, 							_menu_items.item_controller,							_menu_items.descr');		$this->db->from('_positions_menus');		$this->db->join('_menu_items', '_positions_menus._menu_items_rid = _menu_items.rid AND _menu_items.archive = 0');		$this->db->where(array('_positions_menus._positions_rid'=>$uprid, '_positions_menus.archive'=>0));		if(!$all) $this->db->where(array('_positions_menus.hidden'=>0));		$this->db->orderby('_positions_menus.item_order,_menu_items.item_name');		# не показываем скрытые				$query = $this->db->get();		return $query->num_rows()?$query->result_array():array();	}		public function is_allowed($uprid, $irid){		$this->db->select('_positions_menus.rid');		$this->db->from('_positions_menus');		$this->db->join('_menu_items', '_positions_menus._menu_items_rid = _menu_items.rid AND _menu_items.archive = 0');		$this->db->where(array('_positions_menus._positions_rid'=>$uprid, '_positions_menus.archive'=>0, '_positions_menus.rid'=>$irid));		$query = $this->db->get();		return $query->num_rows()?True:False;	}		public function get_controller($irid){		$this->db->select('_menu_items.item_controller');		$this->db->from('_positions_menus');		$this->db->join('_menu_items', '_positions_menus._menu_items_rid = _menu_items.rid AND _menu_items.archive = 0');		$this->db->where(array('_positions_menus.archive'=>0, '_positions_menus.rid'=>$irid));		$query = $this->db->get();		return $query->num_rows()?$query->row()->item_controller:False;	}		public function get_irid_bycname($name){		$this->db->select('_positions_menus.rid');		$this->db->from('_positions_menus');		$this->db->join('_menu_items', '_positions_menus._menu_items_rid = _menu_items.rid AND _menu_items.archive = 0');		$this->db->where(array('_positions_menus.archive'=>0, '_menu_items.item_controller'=>$name, '_positions_menus._positions_rid'=>get_curr_uprid()));		$query = $this->db->get();		return $query->num_rows()?$query->row()->rid:False;	}}
?>