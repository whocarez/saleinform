<div class="grid"><h3><?=$title?></h3><?= form_open(get_currcontroller()."/create/go/mrid/".get_curririd(), array('id'=>'create_'.$orid, 'autocomplete'=>'off'))?><div class="container editform"><?if(validation_errors()){?><div class="error">	<?=validation_errors('<div>', '</div>');?></div>	<?}?><?if($success===False){?><div class="error">	<?=lang('SAVE_SYSTEM_ERROR')?></div><?}?><?if($success===True){?><div class="success">	<?=lang('SAVE_SYSTEM_SUCCESS')?></div><?}?><fieldset>	<legend><?=lang('DOCUMENT')?></legend>	<div class="column span-3">		<?=form_label(lang('DATE_DOC'), 'date_doc')?> <font color="red">*</font>	</div>	<div class="column span-21 last">		<?=form_input('date_doc', date_conv(set_value('date_doc', date('Y-m-d'))), 'id="date_doc" class="text" readonly="readonly" style="width:90px;"')?>		<script type="text/javascript">			$('#date_doc').datepick({showOn: 'button', yearRange: '-60:+60',			buttonImageOnly: true, buttonImage: '<?=base_url()?>public/js/jquery.datapick.package-3.6.1/calendar.gif'});		</script>	</div>	</fieldset><div class="column span-3">	<?=form_label(lang('ADVERTISE'), 'source_name')?> <font color="red">*</font></div><div class="column span-9">	<?=get_advertisessources_vp(set_value('_advertisessources_rid', ''))?></div><div class="column span-3">	<?=form_label(lang('CALL'), 'call_rid')?></div><div class="column span-9 last">	<?=get_calls_vp(set_value('_calls_documents_rid', ''))?></div><fieldset><legend><?=lang('TOUR_INFO')?></legend><div class="column span-3">	<?=form_label(lang('TOUROPERATOR'), '_touroperators_rid')?> <font color="red">*</font></div><div class="column span-21">	<?=get_touroperators_vp(set_value('_touroperators_rid', ''))?></div><div class="column span-3">	<?=form_label(lang('COUNTRY'), '_countries_rid')?> <font color="red">*</font></div><div class="column span-9">	<?=form_dropdown('_countries_rid', get_countries_list(), set_value('_countries_rid', ''), 'id="_countries_rid" class="text" ')?></div><div class="column span-3">	<?=form_label(lang('CUROURT'), 'curourt_name')?></div><div class="column span-9">	<?=get_curourts_vp(set_value('_curourts_rid', ''))?></div><div class="column span-3">	<?=form_label(lang('ROUTE'), 'route')?> <font color="red">*</font></div><div class="column span-21 last">	<?=form_textarea('route', set_value('route', ''), 'class="text" id="route" style="width:400px;height:30px;"')?></div>	<div class="column span-3">	<?=form_label(lang('DATE_FROM'), 'date_from')?> <font color="red">*</font></div><div class="column span-9">	<?=form_input('date_from', date_conv(set_value('date_from', '')), 'id="date_from" class="text" readonly="readonly" style="width:90px;"')?>	<script type="text/javascript">		$('#date_from').datepick({showOn: 'button', yearRange: '-60:+60',		buttonImageOnly: true, buttonImage: '<?=base_url()?>public/js/jquery.datapick.package-3.6.1/calendar.gif'});	</script></div>	<div class="column span-3">	<?=form_label(lang('DATE_TO'), 'date_to')?> <font color="red">*</font></div><div class="column span-9">	<?=form_input('date_to', date_conv(set_value('date_to', '')), 'id="date_to" class="text" readonly="readonly" style="width:90px;"')?>	<script type="text/javascript">		$('#date_to').datepick({showOn: 'button', yearRange: '-60:+60',		buttonImageOnly: true, buttonImage: '<?=base_url()?>public/js/jquery.datapick.package-3.6.1/calendar.gif'});	</script></div><div class="column span-3">	<?=form_label(lang('HOTELCAT'), '_hotelscats_rid')?> <font color="red">*</font></div><div class="column span-9">	<?=form_dropdown('_hotelscats_rid', get_hotelscats_list(), set_value('_hotelscats_rid', ''), 'class="text" id="_hotelscats_rid"')?></div>	<div class="column span-3">	<?=form_label(lang('HOTEL'), 'hotel_name')?> <font color="red">*</font></div><div class="column span-9 last">	<?=form_input('hotel_name', set_value('hotel_name', ''), 'class="text" id="hotel_name"')?></div>	<div class="column span-3">	<?=form_label(lang('ROOM'), '_rooms_rid')?> <font color="red">*</font></div><div class="column span-9">	<?=form_dropdown('_rooms_rid', get_rooms_list(), set_value('_rooms_rid', ''), 'class="text" id="_rooms_rid"')?></div>	<div class="column span-3">	<?=form_label(lang('FOOD'), '_food_rid')?> <font color="red">*</font></div><div class="column span-9 last">	<?=form_dropdown('_food_rid', get_food_list(), set_value('_food_rid', ''), 'class="text" id="_food_rid"')?></div>	<div class="column span-3">	<?=form_label(lang('CROOM'), 'room_cat')?> <font color="red">*</font></div><div class="column span-9">	<?=form_input('room_cat', set_value('room_cat', ''), 'class="text" id="room_cat"')?></div><div class="column span-3">	<?=form_label(lang('TRANSFER'), 'transfer')?> <font color="red">*</font></div><div class="column span-9 last">	<?=form_textarea('transfer', set_value('transfer', ''), 'class="text" id="transfer" style="width:300px;height:40px;"')?></div>	<div class="column span-3">	<?=form_label(lang('EXCURSIONS'), 'excursions')?> <font color="red">*</font></div><div class="column span-21 last">	<?=form_textarea('excursions', set_value('excursions', ''), 'class="text" id="excursions" style="width:400px;height:40px;"')?></div><div class="column span-3">	<?=form_label(lang('CIF'), 'cif')?></div><div class="column span-21 last">	<?=form_textarea('cif', set_value('cif', ''), 'class="text" id="cif" style="width:400px;height:40px;"')?></div><div class="column span-3">	<?=form_label(lang('TOUR_NUM'), 'tour_num')?></div><div class="column span-21 last">	<?=form_input('tour_num', set_value('tour_num', ''), 'class="text" id="tour_num"')?></div>		<div class="column span-3">	<b><?=form_label(lang('APPROVE_TOUR'), 'approve')?></b></div><div class="column span-9">	<?=form_checkbox('approve', 1, set_value('approve', '')==1, 'id="approve"')?></div>	<div class="column span-3">	<b><?=form_label(lang('VISA'), 'visa')?></b></div><div class="column span-9 last">	<?=form_checkbox('visa', 1, set_value('visa', '')==1, ' id="visa"')?></div>		</fieldset><fieldset><legend><?=lang('TOUR_MEMBERS')?></legend><div class="column span-24 last" id="clients_list">	<?=$clients?></div><div class="column span-6">	<b><?=form_label('<b>'.lang('ADD_MEMBER').'</b>', 'client_name')?></b></div><div class="column span-10">	<?=get_clients_vp(set_value('_clients_rid', null))?></div>	<div class="column span-8 last">	<?=form_button('add_client_row', lang('ADD_BTN'), 'class="button" id="add_client_row" style="margin-top: 10px;"')?></div></fieldset><fieldset><legend><?=lang('PRICE_INFO')?></legend><div class="column span-6">	<?=form_label(lang('SUM_TOUR'), 'sum_tour')?> <font color="red">*</font></div><div class="column span-6">	<?=form_input('sum_tour', set_value('sum_tour', ''), 'class="text" id="sum_tour" style="width:100px;"')?></div>	<div class="column span-6">	<?=form_label(lang('CURRENCY'), '_currencies_rid')?> <font color="red">*</font></div><div class="column span-6 last">	<?=form_dropdown('_currencies_rid', get_currencies(), set_value('_currencies_rid', ''), 'id="_currencies_rid" class="text" ')?></div>	<div class="column span-6">	<?=form_label(lang('CURR_COURCE'), 'cource')?> <font color="red">*</font></div><div class="column span-6 last">	<?=form_input('cource', set_value('cource', 1), 'id="cource" class="text" style="width:50px;"')?></div>	<div class="column span-6">	<?=form_label(lang('OPERATOR_KOEFF'), 'to_koeff')?> <font color="red">*</font></div><div class="column span-6 last">	<?=form_input('to_koeff', set_value('to_koeff', 0), 'id="to_koeff" class="text" style="width:50px;"')?></div>	<div class="column span-6">	<?=form_label(lang('DISCOUNT_PER'), 'discount_per')?></div><div class="column span-6">	<?=form_input('discount_per', set_value('discount_per', 0), 'id="discount_per" class="text" style="width:50px;"')?></div>	<div class="column span-6">	<?=form_label(lang('DISCOUNT_FIX'), 'discount_fix')?></div><div class="column span-6 last">	<?=form_input('discount_fix', set_value('discount_fix', 0), 'id="discount_fix" class="text" style="width:50px;"')?></div>	<div class="column span-6">	<?=form_label('<b>'.lang('SUM').'</b>', 'SUM')?></div><div class="column span-18 last">	<?=form_input('sum', set_value('sum', 0), 'id="sum" class="text" style="width:100px;" readonly="readonly"')?>	<?=form_button('recalc', lang('RECALC'), 'class="button" id="recalc" style=""')?></div>	</fieldset><div class="column span-4">	<?=form_label(lang('DESCR'), 'descr')?></div><div class="column span-8">	<?=form_textarea('descr', set_value('descr', ''), 'id="descr" class="text" style="width:200px; height: 50px;"')?></div><div class="column span-4">	<?=form_label(lang('ARCHIVE'), 'archive')?></div><div class="column span-8 last">	<?=form_dropdown('archive', array('0'=>lang('NO'), '1'=>lang('YES')), set_value('archive', ''), 'id="archive" class="text" ')?></div>
</div>
<div class="column span-24 last">	<input type="submit" value="<?=lang('SAVE')?>" class="button" id="submit" name="submit"> <input type="reset" value="<?=lang('CANCEL')?>" class="button" onclick="window.location='<?=site_url(get_currcontroller().'/mrid/'.get_curririd()) ?>';" id="reset" name="reset"></div><?= form_close(); ?></div><script type="text/javascript">function client_processing(cl_rid, mode){	var query_string = '';	if(mode=='add'){		query_string = 'add='+cl_rid+'&'+$("input[name='_cl_rid[]']").serialize();	} else {		query_string = 'remove='+cl_rid+'&'+$("input[name='_cl_rid[]']").serialize();	}	$.ajax({		type: 'POST',		url: "<?=site_url(get_currcontroller()."/getclients/go/mrid/".get_curririd())?>",		data: query_string,		success: function(html){		    $('#clients_list').html(html);		    $("input[name='client_name']").val('');		    $("#_clients_rid").val('');		}	});}$(document).ready(		function(){			$('#add_client_row').click(function(){				var clients_rid = $("input[name='_clients_rid']").val();				if(clients_rid==''){					alert('<?=lang('CLIENT_RID_NOT_SET')?>');				} else {					client_processing(clients_rid, 'add');				}			});			$('#recalc').click(function(){				// пересчет суммы тура на стороне сервера				var query_string = 'sum_tour='+$('#sum_tour').val()+'&'+									'cource='+$('#cource').val()+'&'+									'to_koeff='+$('#to_koeff').val()+'&'+									'discount_per='+$('#discount_per').val()+'&'+									'discount_fix='+$('#discount_fix').val();				$.ajax({					type: 'POST',					url: "<?=site_url(get_currcontroller()."/recalc/go/mrid/".get_curririd())?>",					data: query_string,					success: function(val){						$('#sum').val(val);						return;					} 				});			});			/* -- } Value picker --*/		})	</script>