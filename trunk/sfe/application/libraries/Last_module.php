<?phpif (!defined('BASEPATH')) exit('No direct script access allowed');/* * Last module * Mazvv 03-05-2007*/class Last_module{	private $ciObject;	private $lastNewsQuan = 5;	private $objectsArr = array();	private $STN_news_image_sthumb_path = 'images/news/news_sthumb/';	private $STN_news_image_thumb_path = 'images/news/news_thumb/';	private $STN_news_image_original_path = 'images/news/original_size/';	private $STN_news_images_sthumb_width = 50;	private $STN_news_images_sthumb_height = 50;	private $STN_news_images_thumb_width = 150;	private $STN_news_images_thumb_height = 150;
		public function __construct(){		$this->ciObject = &get_instance();		$this->ciObject->lang->load('last_module');		$this->ciObject->load->model('last_model');	}
	public function renderLastNewsArea(){
		$this->ciObject->load->helper('text');		$result = $this->ciObject->last_model->getLastNews($this->lastNewsQuan);		foreach($result as $key=>$row){			if($row->name) $result[$key]->img = $this->GetNewImage($row);			else $result[$key]->img = null;		}		$data = array('news'=>$result);		return $this->ciObject->load->view('modules/last_module/lastnews.php', $data, True);	}	public function GetNewImage($newROW){		$this->ciObject->load->library('image_lib');		$this->ciObject->image_lib->clear();		$imgORIGINAL = $this->STN_news_image_original_path.$newROW->rid.'_'.$newROW->name;		$imgNEWS  = $this->STN_news_image_sthumb_path.$newROW->rid.'_'.$newROW->name;		if(!file_exists($imgORIGINAL)){			$ifile=fopen($imgORIGINAL, "w");			fwrite($ifile, $newROW->image);			fclose($ifile);		} 							if(!file_exists($imgNEWS)){			$config = array();			$config['image_library'] = 'GD2';			$config['source_image'] = $imgORIGINAL;			$config['new_image'] = $imgNEWS;			$config['create_thumb'] = FALSE;			$config['width'] = $this->STN_news_images_sthumb_width;			$config['height'] = $this->STN_news_images_sthumb_height;			$this->ciObject->image_lib->initialize($config);			if (!$this->ciObject->image_lib->resize()){   				echo $this->ciObject->image_lib->display_errors();			}		} 							$imgNAME = $imgNEWS;		return $imgNAME;	}}
?>